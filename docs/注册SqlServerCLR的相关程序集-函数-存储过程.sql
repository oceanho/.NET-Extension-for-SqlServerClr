

-- enabled clr
EXEC sys.sp_configure  'clr enabled',1
GO
RECONFIGURE; 
GO


SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


/** DateTime functions part **/
IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Get_Date_TotalDays' AND [type]='FN')
	DROP FUNCTION uf_Get_Date_TotalDays
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Get_Date_TotalHours' AND [type]='FN')
	DROP FUNCTION uf_Get_Date_TotalHours
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Get_Date_TotalMinutes' AND [type]='FN')
	DROP FUNCTION uf_Get_Date_TotalMinutes
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Get_Date_TotalSeconds' AND [type]='FN')
	DROP FUNCTION uf_Get_Date_TotalSeconds
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Get_Date_TotalMilliSeconds' AND [type]='FN')
	DROP FUNCTION uf_Get_Date_TotalMilliSeconds
GO

/** DateTime CLR functions part **/
IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Clr_GetPartTotalValue' AND [type]='FS')
	DROP FUNCTION uf_Clr_GetPartTotalValue
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Clr_DateFormator' AND [type]='FS')
	DROP FUNCTION uf_Clr_DateFormator
GO

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_Clr_DateFormatorAsString' AND [type]='FS')
	DROP FUNCTION uf_Clr_DateFormatorAsString
GO





/** NVARCHAR/VARCHAR/Text functions part **/

IF EXISTS(SELECT TOP 1 * FROM sys.objects WHERE name=N'uf_trim' AND type='FN')
	DROP FUNCTION uf_trim
GO


/** NVARCHAR/VARCHAR/Text CLR functions part **/
IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_StartsWith' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_StartsWith]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_EndsWith' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_EndsWith]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_Trim' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_Trim]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_TrimStart' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_TrimStart]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_TrimEnd' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_TrimEnd]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_TrimStartAndEnd' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_TrimStartAndEnd]
GO

IF EXISTS(SELECT TOP 1 * FROM SYS.objects WHERE name=N'uF_SqlClr_IsMatch' AND [type]='FS')
	DROP FUNCTION [uF_SqlClr_IsMatch]
GO


-- DROP CLR Assembly
IF EXISTS(SELECT TOP 1 * FROM SYS.assemblies WHERE name=N'SqlClrExtension')
	DROP ASSEMBLY [SqlClrExtension]
GO

-- CLR 程序集注册
CREATE ASSEMBLY [SqlClrExtension]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103000FE55B560000000000000000E00002210B010B00001C00000008000000000000DE3A00000020000000400000000000100020000000020000040000000000000004000000000000000080000000020000A6E20000030040850000100000100000000010000010000000000000100000000000000000000000843A000057000000004000002804000000000000000000000000000000000000006000000C0000004C3900001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000E41A000000200000001C000000020000000000000000000000000000200000602E72737263000000280400000040000000060000001E0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000002400000000000000000000000000004000004200000000000000000000000000000000C03A0000000000004800000002000500F42700005811000009000000000000000000000000000000502000008000000000000000000000000000000000000000000000000000000000000000000000003DB869ECD6B4BA0A4038AB177D89D5089EEE72B42984A4CA0BAAE805979A33699D59E7EDB0B3F77960E827D20BBB6774C76C04A0D715BE8418CB86351584A47817E553C1C754D2EF3FD541B92E05A0794E4621B73DD067518A1499CB4B110DB2675A0B7B0AE186DC3EEE7E4BCC6F75DA1CFB43D376F8EC20B33B5A9A1E47A485133003008400000001000011188D090000010A0616028C03000001A20617038C03000001A206280E0000062C067E1100000A2A188D090000010B0716028C03000001A20717038C03000001A207280F0000062C067E1200000A2A0F00281300000A0F01281300000A046F1400000A2D1A0F00281300000A0F01281300000A046F1500000A281600000A2A7E1100000A2A133003008400000001000011188D090000010A0616028C03000001A20617038C03000001A206280E0000062C067E1100000A2A188D090000010B0716028C03000001A20717038C03000001A207280F0000062C067E1200000A2A0F00281300000A0F01281300000A046F1400000A2D1A0F00281300000A0F01281300000A046F1700000A281600000A2A7E1100000A2A133003004D00000002000011178D090000010B071603A207280E0000062C02022A178D090000010C0816028C03000001A208280E0000062C067E1800000A2A0F00281300000A0A06036F1900000A6F1A00000A731B00000A2A000000133003004D00000002000011178D090000010B071603A207280E0000062C02022A178D090000010C0816028C03000001A208280E0000062C067E1800000A2A0F00281300000A0A06036F1900000A6F1C00000A731B00000A2A000000133003004D00000002000011178D090000010B071603A207280E0000062C02022A178D090000010C0816028C03000001A208280E0000062C067E1800000A2A0F00281300000A0A06036F1900000A6F1D00000A731B00000A2A2602030328070000062A00133003007000000002000011188D090000010B071603A2071704A207280E0000062C02022A178D090000010C0816028C03000001A208280E0000062C067E1800000A2A0F00281300000A0A046F1E00000A2D0D06046F1900000A6F1D00000A0A036F1E00000A2D0D06036F1900000A6F1C00000A0A06731B00000A2A1330030080010000030000117E1F00000A0A178D090000010B0716048C03000001A207280F0000062C02062A178D090000010C0816028C07000001A208280F0000062C02062A178D090000010D0916038C07000001A209280F0000062C02062A0F01282000000A0F00282000000A282100000A2C02062A0F02281300000A72010000701B6F1400000A2C2312000F01282000000A0F00282000000A282200000A13041204282300000A282400000A0F02281300000A72150000701B6F1400000A2C2312000F01282000000A0F00282000000A282200000A13051205282500000A282400000A0F02281300000A722B0000701B6F1400000A2C2312000F01282000000A0F00282000000A282200000A13061206282600000A282400000A0F02281300000A72450000701B6F1400000A2C2312000F01282000000A0F00282000000A282200000A13071207282700000A282400000A0F02281300000A725F0000701B6F1400000A2C2312000F01282000000A0F00282000000A282200000A13081208282800000A282400000A062A133003005A00000004000011020A178D090000010B0716028C07000001A207280F0000062C02062A178D090000010C0816038C03000001A208280F0000062C02062A12001200282000000A0D12030F01281300000A282900000A282A00000A282B00000A062A0000133003006C00000005000011178D090000010A0616028C07000001A206280F0000062C067E1800000A2A178D090000010B0716038C03000001A207280F0000062C1A0F00282000000A0C12027283000070282900000A282C00000A2A0F00282000000A0D12030F01281300000A282900000A731B00000A2A133003003E00000006000011178D090000010C0816028C03000001A208280E0000062C067E1800000A2A282D00000A0F00281300000A6F2E00000A0A06282F00000A0B07731B00000A2A0000133003003E00000006000011178D090000010C0816028C03000001A208280E0000062C067E1800000A2A0F00281300000A283000000A0A282D00000A066F3100000A0B07731B00000A2A0000133003008400000001000011188D090000010A0616028C03000001A20617038C03000001A206280E0000062C067E1100000A2A188D090000010B0716028C03000001A20717038C03000001A207280F0000062C067E1200000A2A0F00281300000A0F01281300000A176F1400000A2D1A0F00281300000A0F01281300000A04283200000A281600000A2A7E1100000A2A133002002700000007000011022C20020C160D2B1408099A0A066F3300000A2D04160BDE0C0917580D09088E6932E6172A072A00133002002700000007000011022C20020C160D2B1408099A0A066F3300000A2C04170BDE0C0917580D09088E6932E6162A072A3E02030F02283500000A280D0000062A3E02030F02283600000A28010000062A3E02030F02283600000A28020000062A2602030428080000062A22020328090000062A220203280A0000062A22020328030000062A22020328040000062A22020328050000062A2602030428070000062A42534A4201000100000000000C00000076322E302E35303732370000000005006C00000030060000237E00009C060000D405000023537472696E677300000000700C0000AC000000235553001C0D00001000000023475549440000002C0D00002C04000023426C6F620000000000000002000001471502000900000000FA2533001600000100000023000000030000001900000038000000360000001900000007000000010000000300000000000A000100000000000600880081000A00B0009B000A00BB009B000600C50081000A00EA009B000A001A019B000A0024019B000E009D017E010A00B2019B000A00D0019B000A00D9019B00060055028100060081026F02060098026F020600B5026F020600D4026F020600ED026F02060006036F02060021036F0206003C036F02060074035503060088035503060096036F020600AF036F020600DF03CC036700F30300000600220402040600420402040600850481000600B40481000600C904810006005105450506006C0581000E009E057E010A00BF05A4050000000001000000000001000100800110001E002F00050001000100810110004D006200050001001000D020000000009300D6000A0001006021000000009300E1000A000400F021000000009300F300150007004C22000000009300F80015000900A822000000009300020115000B0001230000000093000A0115000D000C230000000093000A011E000F00882300000000930030012900120014250000000093004201340015007C250000000093004F013D001700F4250000000093006401460019004026000000009300710146001A008C26000000009300AA014D001B001C27000000009100BC0158001E005027000000009100C60158001F008327000000009600AA015F0020009327000000009600D6006A002300A327000000009600E1006A002600B327000000009600300129002900BD27000000009600420134002C00C6270000000096004F013D002E00CF27000000009600F30015003000D827000000009600F80015003200E127000000009600020115003400EA270000000096000A011E00360000000100E10100000200E50100000300E90100000100E10100000200E50100000300E90100000100E10100000200E50100000100E10100000200E50100000100E10100000200E50100000100E10100000200E50100000100E10100000200FA01000003000302000001000A02000002001402000003001F02000001002402000002002902000001002402000002002902000001003202000001003202000001003202000002003802000003004002000001004C02000001004C0200000100320200000200380200000300400200000100E10100000200E50100000300E90100000100E10100000200E50100000300E901000001000A02000002001402000003001F0200000100240200000200290200000100240200000200290200000100E10100000200E50100000100E10100000200E50100000100E10100000200E50100000100E10100000200FA01000003000302610069027500690069027E00710069027E00790069027E00810069027E00890069027E00910069027E00990069027E00A10069027E00A90069028300B10069027E00B90069027E00C10069027E00C90069028800D90069028E00E1006902750011007004350111007504350119007B043901E9008C043D01E900D6003D01110093044401E900E1003D0119009F04530129007B045701E900F3005C01190069027E00E900F8005C01E90002015C012900A4046C013100AF04700139007B047401F100BD047901F100D2048101F900E1048A01310069028E01F900EF048A01F900FE048A01F9000F058A01F90020058A01F1003605AB01F1003F05B00139006902B60119009304C90101015A05DC0101016305E20109017405E80109018305F70101019405FD011101AA0103024900A4046C0119016902750051007B043D0359007B0441032E00130045032E007B0003042E0083000C042E001B006B032E007300FA032E003B009F032E006B00E8032E002B0092032E0033006B032E0023008C032E0043008C032E0053008C032E005B00BE030002A30115022002A30115024002A30115026002A30115028002A3011502A002A3011502C002A3011502E002A30115020003A30115022003A3011502C4030B007900E4030B0079004A0162019301BC01CF01EE010B02048000000F000B000D00690001000000930060040000020000000000000000000000010078000000000002000000000000000000000001008F000000000002000000000000000000000001008100000000000000003C4D6F64756C653E0053716C436C72457874656E73696F6E2E646C6C0053716C537472696E675574696C6974790053716C536572766572436C72457874656E73696F6E2E5574696C6974790053716C536572766572436C7252656769737465720053716C536572766572436C72457874656E73696F6E006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C426F6F6C65616E0053716C537472696E6700537472696E67436F6D70617269736F6E005374617274735769746800456E6473576974680053716C4368617273005472696D005472696D5374617274005472696D456E64005472696D5374617274416E64456E640053716C446F75626C650053716C4461746554696D650047657450617274546F74616C56616C75650044617465466F726D61746F720044617465466F726D61746F724173537472696E6700426173653634456E636F6465004261736536344465636F64650053797374656D2E546578742E526567756C617245787072657373696F6E730052656765784F7074696F6E730049734D6174636800494E756C6C61626C65004973416C6C4E756C6C004973416E794E756C6C0053716C496E7433320053716C42797465007372630064657300636F6D70617269736F6E4F7074696F6E00737461727444657300656E64446573007374617274446174650066696E697368446174650070617274006461746500666F726D61746F7200696E707574007061747465726E0072656765784F7074696F6E00617267756D656E7400506172616D4172726179417474726962757465002E63746F720053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C65417474726962757465004775696441747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C436C72457874656E73696F6E00547275650046616C7365006765745F56616C756500537472696E6700457175616C73006F705F496D706C69636974004E756C6C006765745F49734E756C6C005A65726F004461746554696D65006F705F4C6573735468616E0054696D655370616E006F705F5375627472616374696F6E006765745F546F74616C44617973006765745F546F74616C486F757273006765745F546F74616C4D696E75746573006765745F546F74616C5365636F6E6473006765745F546F74616C4D696C6C697365636F6E647300546F537472696E670050617273650053797374656D2E5465787400456E636F64696E67006765745F5554463800476574427974657300436F6E7665727400546F426173653634537472696E670046726F6D426173653634537472696E6700476574537472696E67005265676578004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E41747472696275746500001354006F00740061006C004400610079007300001554006F00740061006C0048006F00750072007300001954006F00740061006C004D0069006E007500740065007300001954006F00740061006C005300650063006F006E0064007300002354006F00740061006C004D0069006C006C0069007300650063006F006E0064007300002779007900790079002F004D004D002F00640064002000480048003A006D006D003A00730073000000E0ABE70115E0134A9C63A1C9598D70070008B77A5C561934E0890A00031109110D110D1111080002110D110D12150A0003110D110D121512150A00031119111D111D110D080002111D111D110D080002110D111D110D060001110D110D0A00031109110D110D1121060001021D12250A00031109110D110D11290A00031109110D110D112D032000010401000000042001010E0420010102052001011169042001010880A0002400000480000094000000060200000024000052534131000400000100010077BF9B509FDD76F2B1FCD671A357E2929EB1F69B297D947C817C7276C3BB2F278A77666BC15EFC4E523B192DBA0F8D416190481D5A9491CF1A63D13C4EBACB63293FF17EED2DB4C83BE1371F140396F9618434A64493BE664854DB99209C6B4EAD4168B8EA2FAFF35D5BB178A1E21B1E046B0DA10C6DA88C6F19B73774719DF6030611090320000E062002020E11110500011109020807021D12251D12250306110D0420001D030520010E1D030907030E1D12251D1225032000020306111904200011790700020211791179080002117D117911790320000D042001010D17070911191D12251D12251D1225117D117D117D117D117D0420010E0E05000111790E0520010111790C0704111D1D12251D12251179050001110D0E0C07041D12251D1225117911790500001280810520011D050E0500010E1D050807031D050E1D12250500011D050E0520010E1D05070003020E0E11210907041225021D1225088126010002005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373000000000320000803200005250100204E45542D457874656E73696F6E20666F722053716C536572766572203230303800002001001B4E45542D457874656E73696F6E20666F722053716C53657276657200000501000000000C0100074F6365616E486F00001E010019436F7079726967687420C2A9204F6365616E486F203230313500002901002438623966343564392D356663372D343964652D623464642D65653937366439313764613200001101000C31352E31312E31332E31303500000801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000000FE55B5600000000020000001C01000068390000681B000052534453F380BF59D84F7F4E9DA2D4EB1C95EDE901000000653A5C776F726B726F6F745C6F70656E736F757263655C2E4E455420457874656E73696F6E20666F722053716C536572766572436C725C7372635C457874656E73696F6E20666F722053716C536572766572323030385C6F626A5C52656C656173655C53716C436C72457874656E73696F6E2E70646200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000AC3A00000000000000000000CE3A0000002000000000000000000000000000000000000000000000C03A00000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000D00300000000000000000000D00334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE000001000B000F0069000D000B000F0069000D003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00430030000010053007400720069006E006700460069006C00650049006E0066006F0000000C030000010030003000300030003000340062003000000050001C00010043006F006D006D0065006E007400730000004E00450054002D0045007800740065006E00730069006F006E00200066006F0072002000530071006C00530065007200760065007200000030000800010043006F006D00700061006E0079004E0061006D006500000000004F006300650061006E0048006F0000006C0021000100460069006C0065004400650073006300720069007000740069006F006E00000000004E00450054002D0045007800740065006E00730069006F006E00200066006F0072002000530071006C0053006500720076006500720020003200300030003800000000003C000D000100460069006C006500560065007200730069006F006E0000000000310035002E00310031002E00310033002E003100300035000000000048001400010049006E007400650072006E0061006C004E0061006D0065000000530071006C0043006C00720045007800740065006E00730069006F006E002E0064006C006C0000005800190001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004F006300650061006E0048006F0020003200300031003500000000005000140001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C0043006C00720045007800740065006E00730069006F006E002E0064006C006C00000058001C000100500072006F0064007500630074004E0061006D006500000000004E00450054002D0045007800740065006E00730069006F006E00200066006F0072002000530071006C00530065007200760065007200000040000D000100500072006F006400750063007400560065007200730069006F006E000000310035002E00310031002E00310033002E003100300035000000000044000D00010041007300730065006D0062006C0079002000560065007200730069006F006E000000310035002E00310031002E00310033002E003100300035000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000E03A00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET=SAFE
GO

-- ===============================================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 进行时间格式化处理，返回新的时间
-- ===============================================================
CREATE FUNCTION uf_Clr_DateFormator
(	
	@date AS DATETIME,							-- 指定时间
	@formator AS NVARCHAR(30)					-- CSharp支持的时间格式化字符
)
RETURNS DATETIME
AS 
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].[DateFormator]; 	
GO


-- ===============================================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 进行时间格式化处理，返回字符串
-- =============================================================
CREATE FUNCTION uf_Clr_DateFormatorAsString
(	
	@date AS DATETIME,							-- 指定时间
	@formator AS NVARCHAR(30)					-- CSharp支持的时间格式化字符
)
RETURNS NVARCHAR(30)
AS 
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].[DateFormatorAsString]; 	
GO



-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 获取2个时间差指定partString部分的值
/*
	@startDate：开始时间
	@startDate：结束时间
	@partString：差值部分（TotalDays,TotalHours,TotalMinutes,TotalSeconds,TotalMilliseconds）
*/
-- ==================================================================
CREATE FUNCTION uf_Clr_GetPartTotalValue
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME,						-- 结束时间
	@partString AS NVARCHAR(30)						-- 差值部分
)
RETURNS DOUBLE PRECISION
AS 
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].[GetPartTotalValue]; 	
GO
/*
SELECT dbo.uf_Clr_GetPartTotalValue(getdate(),DATEADD(d,1,getdate()),'totaldays')
SELECT dbo.uf_Clr_GetPartTotalValue(getdate(),DATEADD(d,1,getdate()),'totalhours')
SELECT dbo.uf_Clr_GetPartTotalValue(getdate(),DATEADD(d,1,getdate()),'totalminutes')
SELECT dbo.uf_Clr_GetPartTotalValue(getdate(),DATEADD(d,1,getdate()),'totalseconds')
SELECT dbo.uf_Clr_GetPartTotalValue(getdate(),DATEADD(d,1,getdate()),'totalmilliseconds')
*/



/*
*
*	判断 @src 否以 @des 字符串开头、满足条件返回1，不满足返回0、注意：若@src 与 
*	@des 都为 NULL ，返回 1，@src 或 @des 为 NULL ，返回 0
-------------------------------------------------------------------------------
	@src：需要判断的源字符
	@des：判断的比较字符串
	@comparsionOption：比较使用的区域、大小写和排序规则，与CSharp 枚举
	StringComparison 保持一致，可选值如下；
	0：使用区域敏感排序规则和当前区域比较字符串。
	1：使用区域敏感排序规则、当前区域来比较字符串，同时忽略被比较字符串的大小写。
	2：使用区域敏感排序规则和固定区域比较字符串。
	3：使用区域敏感排序规则、固定区域来比较字符串，同时忽略被比较字符串的大小写。
	4：使用序号排序规则比较字符串。
	5：使用序号排序规则并忽略被比较字符串的大小写，对字符串进行比较。
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_StartsWith
(
	@src NVARCHAR(MAX),
	@des NVARCHAR(200)=N'',
	@comparsionOption TINYINT=3
)
RETURNS bit
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].StartsWith
GO


/*
*
*	判断 @src 否以 @des 字符串结尾、满足条件返回1，不满足返回0、注意：若@src 与 
*	@des 都为 NULL ，返回 1，@src 或 @des 为 NULL ，返回 0
-------------------------------------------------------------------------------
	@src：需要判断的源字符
	@des：判断的比较字符串
	@comparsionOption：比较使用的区域、大小写和排序规则，与CSharp 枚举
	StringComparison 保持一致，可选值如下；
	0：使用区域敏感排序规则和当前区域比较字符串。
	1：使用区域敏感排序规则、当前区域来比较字符串，同时忽略被比较字符串的大小写。
	2：使用区域敏感排序规则和固定区域比较字符串。
	3：使用区域敏感排序规则、固定区域来比较字符串，同时忽略被比较字符串的大小写。
	4：使用序号排序规则比较字符串。
	5：使用序号排序规则并忽略被比较字符串的大小写，对字符串进行比较。
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_EndsWith
(
	@src NVARCHAR(MAX),
	@des NVARCHAR(200)=N'',
	@comparsionOption TINYINT=3
)
RETURNS bit
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].EndsWith
GO


/*
*
*	删除 @src 中包含的 @des 字符，并返回删除后的新字符、注意：若@src 与 
*	@des 都为 NULL 或 @src 为 NULL 返回 NULL
-------------------------------------------------------------------------------
	@src：需要进行删除处理的源字符
	@des：进行删除处理的判断字符串
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_Trim
(
	@src NVARCHAR(MAX),
	@des NVARCHAR(200)=N' '
)
RETURNS NVARCHAR(MAX)
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].Trim
GO

/*
*
*	删除 @src 以 @des 开始字符，并返回删除后的新字符、注意：若@src 与 
*	@des 都为 NULL 或 @src 为 NULL 返回 NULL
-------------------------------------------------------------------------------
	@src：需要进行删除处理的源字符
	@des：进行删除处理的判断字符串
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_TrimStart
(
	@src NVARCHAR(MAX),
	@des NVARCHAR(200)=N' '
)
RETURNS NVARCHAR(MAX)
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].TrimStart
GO


/*
*
*	删除 @src 以 @des 结尾字符，并返回删除后的新字符、注意：若@src 与 
*	@des 都为 NULL 或 @src 为 NULL 返回 NULL
-------------------------------------------------------------------------------
	@src：需要进行删除处理的源字符
	@des：进行删除处理的判断字符串
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_TrimEnd
(
	@src NVARCHAR(MAX),
	@des NVARCHAR(200)=N' '
)
RETURNS NVARCHAR(MAX)
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].TrimEnd
GO


/*
*
*	删除 @src 以为 @startDes开头和以 @endDes 结尾字符，并返回删除后的新字符、
*	注意：若@src 与 @des 都为 NULL 返回 NULL
-------------------------------------------------------------------------------
	@src：需要进行删除处理的源字符
	@startDes：开始匹配删除处理的判断字符串
	@endDes：结束匹配删除处理的判断字符串
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_TrimStartAndEnd
(
	@src NVARCHAR(MAX),
	@startDes NVARCHAR(200)=N' ',
	@endDes NVARCHAR(200)=N' '
)
RETURNS NVARCHAR(MAX)
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].TrimStartAndEnd
GO




/*
*
*	判断 @input 否满足 @pattern 正则匹配、满足条件返回1，不满足返回0、
*	注意：若@input 与 @pattern 都为 NULL ，返回 1
-------------------------------------------------------------------------------
	@input：输入字符串
	@pattern：正则表达式字符
	@regexOption：提供用于设置正则表达式选项
		与 System.Text.RegularExpressions.RegexOptions 一致，此参数支持位运算。
	可选值如下；
	0：指定不设置任何选项。        
    1：指定不区分大小写的匹配。
	2：多行模式。 更改 ^ 和 $ 的含义，使它们分别在任意一行的行首和行尾匹配，而不仅仅在整个字符串的开头和结尾匹配。
    4：指定唯一有效的捕获是显式命名或编号的 (?<name>…) 形式的组。 这使未命名的圆括号可以充当非捕获组，并且不会使表达式的语法 (?:...) 显得笨拙。
	8：指定将正则表达式编译为程序集。 这会产生更快的执行速度，但会增加启动时间。 在调用 System.Text.RegularExpressions.Regex.CompileToAssembly(System.Text.RegularExpressions.RegexCompilationInfo[],System.Reflection.AssemblyName)
       方法时，不应将此值分配给 System.Text.RegularExpressions.RegexCompilationInfo.Options 属性。
	16：指定单行模式。 更改点 (.) 的含义，以使它与每个字符（而不是除 \n 之外的所有字符）匹配。
    32：消除模式中的非转义空白并启用由 # 标记的注释。 但是，System.Text.RegularExpressions.RegexOptions.IgnorePatternWhitespace
		值不会影响或消除字符类中的空白。        
    64：指定搜索从右向左而不是从左向右进行。
	256：为表达式启用符合 ECMAScript 的行为。 该值只能与 System.Text.RegularExpressions.RegexOptions.IgnoreCase、System.Text.RegularExpressions.RegexOptions.Multiline
       和 System.Text.RegularExpressions.RegexOptions.Compiled 值一起使用。 该值与其他任何值一起使用均将导致异常。
    512：指定忽略语言中的区域性差异。 有关更多信息，请参见正则表达式选项。

	select 1 | 2 | 4 | 8 | 16 | 32 | 64 | 256 | 512
-------------------------------------------------------------------------------*/
CREATE FUNCTION uF_SqlClr_IsMatch
(
	@input NVARCHAR(MAX),
	@pattern NVARCHAR(200)=N'',
	@regexOption INT=895
)
RETURNS bit
AS
	EXTERNAL NAME [SqlClrExtension].[SqlServerClrExtension.SqlServerClrRegister].IsMatch
GO



/*-- 对SqlClr程序集的SqlServer函数扩展 --*/

-- 同时去除 空格与制表符Tab
CREATE FUNCTION uf_trim(
	@src NVARCHAR(MAX)
) RETURNS NVARCHAR(MAX) AS
BEGIN
	RETURN dbo.uF_SqlClr_Trim(dbo.uF_SqlClr_Trim(@src,N' '),N'	')
END
GO

/*
SELECT dbo.uf_trim(N'')
SELECT ''
SELECT dbo.uf_trim(' 1                               ')

SELECT dbo.uF_SqlClr_Trim(N'何海 ',N'	') ---'何海 '

SELECT dbo.uF_SqlClr_StartsWith(N'abcdef',N'何',3)
SELECT dbo.uF_SqlClr_EndsWith(N'abcdef',N'f',3)
SELECT LEN( dbo.uF_SqlClr_Trim(N'hehai ',N' ') )
*/


-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- 通过SqlServer CLR 获取2个时间之间的总天数差值
/*
	@startDate：开始时间
	@startDate：结束时间
	@partString：差值部分（TotalDays,TotalHours,TotalMinutes,TotalSeconds,TotalMilliseconds）
*/
-- ==================================================================
CREATE FUNCTION uf_Get_Date_TotalDays
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME							-- 结束时间
)
RETURNS DOUBLE PRECISION
AS
BEGIN
	DECLARE @return DOUBLE PRECISION
	SELECT @return= dbo.uf_Clr_GetPartTotalValue(@startDate,@finishDate,'totaldays')
	RETURN @return
END
GO

-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 获取2个时间之间的总小时差值
/*
	@startDate：开始时间
	@startDate：结束时间	
*/
-- ==================================================================
CREATE FUNCTION uf_Get_Date_TotalHours
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME							-- 结束时间
)
RETURNS DOUBLE PRECISION
AS
BEGIN
	DECLARE @return DOUBLE PRECISION
	SELECT @return= dbo.uf_Clr_GetPartTotalValue(@startDate,@finishDate,'totalHours')
	RETURN @return
END
GO

-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 获取2个时间之间的总分钟差值
/*
	@startDate：开始时间
	@startDate：结束时间	
*/
-- ==================================================================
CREATE FUNCTION uf_Get_Date_TotalMinutes
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME							-- 结束时间
)
RETURNS DOUBLE PRECISION
AS
BEGIN
	DECLARE @return DOUBLE PRECISION
	SELECT @return= dbo.uf_Clr_GetPartTotalValue(@startDate,@finishDate,'totalminutes')
	RETURN @return
END
GO

-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 获取2个时间之间的总秒差值
/*
	@startDate：开始时间
	@startDate：结束时间	
*/
-- ==================================================================
CREATE FUNCTION uf_Get_Date_TotalSeconds
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME							-- 结束时间
)
RETURNS DOUBLE PRECISION
AS
BEGIN
	DECLARE @return DOUBLE PRECISION
	SELECT @return= dbo.uf_Clr_GetPartTotalValue(@startDate,@finishDate,'totalseconds')
	RETURN @return
END
GO

-- =============================================
-- Author:		hehai
-- Create date: 2015-11-29 10:41:21
-- Description:	通过SqlServer CLR 获取2个时间之间的总毫秒差值
/*
	@startDate：开始时间
	@startDate：结束时间	
*/
-- ==================================================================
CREATE FUNCTION uf_Get_Date_TotalMilliSeconds
(	
	@startDate AS DATETIME,							-- 开始时间
	@finishDate AS DATETIME							-- 结束时间
)
RETURNS DOUBLE PRECISION
AS
BEGIN
	DECLARE @return DOUBLE PRECISION
	SELECT @return= dbo.uf_Clr_GetPartTotalValue(@startDate,@finishDate,'totalmilliseconds')
	RETURN @return
END
GO
